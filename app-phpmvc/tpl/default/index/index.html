<!--{ include inc-beforbody.html }-->
<body>
<div class="content" id="content">



<h1>框架介绍</h1>
<p>你好 webooxx !</p>


<h2>模板使用</h2>

<h3>模板静态关键字</h3>

<ul>
    <li>网站根目录路径 关键字 "..&#47;../" 转为 <b>//当前域名/网站目录/</b> 实际效果 <code>../../</code> </li>
    <li>网站当前主题公共目录路径 关键字 " ..&#47;Public/" 转为  <b>//当前域名/网站目录/项目目录/模板目录/主题目录/Public/</b> 实际效果 <code>../Public/</code></li>
</ul>

<h3>控制器代码</h3>
<pre>
function index(){
    $this->assign('title','你好 webooxx!');
    $this->assign('description','这是一段程序输出的描述信息');
    $this->assign('data', array( 'First' ,'Second' ,' ..&#47;../ ') );
    $this->display();
}
</pre>
<h3>变量展现</h3>
<p>$title => <!--{$title}--></p>
<p>$description => <!--{$description}--></p>
<p>$data => <!--{ foreach($data as $k =>$v){ }--> 键 <!--{$k}-->,值 <!--{$v}--><br /> <!--{ } }--></p>


<h2>数据库使用</h2>
<pre>

1. 通过 index.php 中的配置

$c['DB_ENGINE'] = 'Csv';
or
$c['DB_ENGINE'] = 'Mysql';

$c['DB_PREFIX']= 'blog_',
$c['DB_HOST' ]= '127.0.0.1',
$c['DB_PORT' ]= '3306',
$c['DB_NAME' ]= 'test',
$c['DB_USERNAME' ]= 'root',
$c['DB_PASSWORD' ]= '',
$c['DB_DEFCHART' ]= 'UTF8',


2. 在控制器的构造器或者方法中手动设置

S('DB_ENGINE',Csv)
S('DB_PREFIX',csv)  #   相对于项目主目录，（使用CSV为数据库一般是小型项目，或者是运行在LINUX下的项目，故不考虑对网络存储的支持）

</pre>


<h2>典型项目配置</h2>

<h3>目录结构</h3>
<ul>

<li><b>/index.php</b> 网站程序入口文件，文件内容
<pre>
define('DIR_NOW',dirname($_SERVER['SCRIPT_FILENAME']));
define('DIR_MVC',DIR_NOW.'/mvc');

#   定义系统框架文件和配置文件
define('FILE_MVC',DIR_MVC.'/ooxx.php');


function _configs(){
    #   返回一个参数数组
    $c = array();
    #   项目目录
    $c['DIR_APP'] = 'app-demo';

    if( getenv('SERVER_HOST') == '127.0.0.1' ){
        #   本地环境配置指定
        $c['DEV_MOD'] = true;
    }else{
        #   线上环境配置指定
    }
    return $c;
}

$app = include(FILE_MVC);$app->run( _configs() ,$argv );
</pre>
</li>


<li><b>/app-demo</b> 项目程序主目录，项目主目录内目录结构配置建议
<pre>
    /app-demo/act/                  #   控制器文件主目录
    /app-demo/act/indexAction.php
    /app-demo/tpl/                  #   模板主题主目录
    /app-demo/tpl/default           #   默认模板主题目录
    /app-demo/tpl/default/index     #   默认模板主题对应index控制器文件目录
    /app-demo/tpl/default/index/index.html      #   默认模板主题对应index控制器中index方法模板文件
    /app-demo/tpl/default/Public/   #   默认模板主题下样式资源公共目录
</pre>
</li>

</ul>

</h3>

<h2>最简配置方案</h2>

<h2>配置参数完整详解</h2>

<h3>默认需要的参数配置</h3>
<h3>可动态修改的参数配置</h3>
<h3>其他可选择参数配置</h3>


<h2>快捷函数</h2>
<h3>快捷方式</h3>
<h3>效率函数</h3>


<h2>关键目录、文件详解</h2>
<p> / 为网站的根目录</p>

<ul>
<li>/index.php</li>
<li>/mvc/ooxx.php</li>
<li>/app-demo/</li>
<li>/app-demo/act</li>
<li>/app-demo/act/indexAction.php</li>
<li>/app-demo/tpl/</li>
<li>/app-demo/tpl/index/</li>
<li>/app-demo/tpl/Public/</li>
<li>/app-demo/inc/</li>
<li>/app-demo/_/</li>
</ul>

<h2>框架结构实现原理流程</h2>

<h2>URLRewrite</h2>
<h3>SAE控制器方法通用rewrite规则</h3>
<pre>
- rewrite: if( path ~ "^/((?!index\.php)[^/]*)$" ) goto "/index.php?m=index&a=$1"
- rewrite: if( path ~ "^/((?!index\.php)[^/]*)/([^/]*)$" ) goto "/index.php?m=$1&a=$2"
</pre>
<p>如果域名后面接一个不包含"/"的字符串，则默认跳转到index的控制器下，执行对应字符串的方法</p>
<p>如果域名后面接一个以"/"分割的两个字符串，则默认跳转到 第一个字符串指向 的控制器下，执行 第二个字符串指向  对应字符串的方法</p>
<p>注意，由于SAE的规则会循环匹配，所以rewrite后的规则注意不要与本身匹配，以免造成死循环</p>

<h3>SAE在线文档平台rewrite规则</h3>
<pre>
- rewrite: if( path ~ "^(/(?!index\.php|app\-doc).*)$" ) goto "/index.php?p=$1"
</pre>

<h2>云存储和缓存</h2>
<p>MemCache的单个缓存为1M，云存储和持久化存储是一个概念</p>
<ul>
<li>本地文件处理</li>
<li>普通文件云存储</li>
<li>CSV数据库使用云存储</li>
<li>memcache缓存模板编译文件缓存</li>
</ul>

</div>

<script type="text/javascript">
    var wrapper = T('<div id="structure">').appendTo( T('body') ).append('<div id="title">文档结构索引').append(T('<div>').hide()).children().last(),
    allElems = T('#content').children(),result = [];

    for (var i = 0, j = allElems.length; i < j; i++) {
        var tagName = allElems[i].tagName.toLowerCase();
        var match   = tagName.match(/h([2-9])/);
        if ( match != null ) {
            level = match[1];
            allElems[i].id =  '_an_'+result.length;
            result.push( '<li style="padding-left:' + (level - 2) + 'em"><a href="#_an_' + result.length + '">' + allElems[i].innerHTML + '</a></li>' );
        }
    }
    result.push( '<li class="top"> <a href="#">返回顶部</a> <a href="#">收起</a></li>' );

    T.insertHTML(wrapper, 'beforeEnd', '<ul>' + result.join('') + '</ul>' );

    T('#structure #title').click(function(){ T('#structure').children().last().toggle(); })
    T('#structure .top a').last().click(function(){ T('#structure').children().last().toggle(); })
</script>

</body>
</html>